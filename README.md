---
title: Milky Bot
emoji: 🥛
colorFrom: blue
colorTo: pink
sdk: docker
app_port: 7860
pinned: false
secrets:
  - DISCORD_BOT_TOKEN
  - BOT_OWNER_ID
  - HF_TOKEN
  - HF_DATA_REPO_ID
---

# Milky Bot - 智能 Discord 机器人

一个功能丰富的Discord机器人，具备AI对话、自动反应、用户分析、数据管理等多种功能。

## ✨ 核心特性

### 🧠 AI智能对话
- **多模型支持**：基于Google Gemini API，支持多种AI模型
- **上下文记忆**：保持对话连续性，最多30轮对话历史
- **人格切换**：内置多种人格模式，支持自定义人格
- **风格调整**：可切换不同回复风格（默认、侦探、猫娘等）
- **表情包支持**：自动识别和转换服务器表情包
- **私聊授权**：支持私聊对话，需要主人授权

### 💕 文爱模式 (智能个性化)
- **用户风格分析**：分析用户最近8条发言
- **多维度识别**：语言风格、表情使用、语气特点、话题偏好
- **活跃时间分析**：识别用户活跃时段
- **个性化回复**：根据分析结果生成贴合用户个性的回复
- **权限管理**：需要主人开启模式和授权用户

### 🤖 自动反应系统
- **智能反应**：为指定用户自动添加表情反应
- **快速响应**：0.3秒延迟，支持动态调整
- **自动清理**：新消息时自动清理旧反应
- **权限控制**：主人可管理用户反应权限

### 📊 数据管理功能
- **发言总结**：收集用户或全服发言数据
- **多格式输出**：简洁、详细、向量化三种格式
- **空间优化**：向量化格式节省50-60%存储空间
- **进度显示**：实时显示数据收集进度
- **统计分析**：提供详细的发言统计信息

### 🎮 用户互动系统
- **签到系统**：每日签到获取积分/爱意
- **积分管理**：查看和管理用户积分
- **连续签到**：连续签到获得额外奖励
- **主人特权**：主人享受特殊待遇和专属功能

### 🛡️ 管理工具
- **权限管理**：私聊授权、文爱权限、自动反应权限
- **屏蔽词系统**：自动过滤不当内容
- **上下文清理**：清除对话历史记录
- **状态监控**：查看bot运行状态和延迟
- **AI密钥轮换**：支持多个API密钥自动轮换

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Discord Bot Token
- Google Gemini API Key(s)

### 安装步骤

1. **克隆仓库**
```bash
git clone https://huggingface.co/spaces/eseeehin/Milyk-bot
cd Milyk-bot
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **配置环境变量**
```bash
# 必需配置
BOT_TOKEN=your_discord_bot_token
BOT_OWNER_ID=your_discord_user_id
GEMINI_API_KEYS=key1,key2,key3

# 可选配置
BOT_PERSONA=你的自定义人格设定
```

4. **运行机器人**
```bash
python bot.py
```

## 📖 命令指南

### 🧠 AI对话命令
```
@机器人 你好          # 在服务器中@机器人对话
/人格 persona:米尔可主人格    # 切换AI人格
/风格 style:猫娘      # 切换回复风格
/清除上下文          # 清除对话历史
```

### 💕 文爱模式命令
```
/文爱模式 开启        # 开启文爱模式
/文爱权限 添加 user:@用户    # 授权用户使用文爱模式
/文爱权限 列表        # 查看授权用户列表
/文爱权限 移除 user:@用户    # 移除用户权限
```

### 🤖 自动反应命令
```
/自动反应 添加 user:@用户 emoji:❤️    # 设置自动反应
/自动反应 延迟 0.2    # 设置反应延迟时间
/自动反应 列表        # 查看所有自动反应规则
/自动反应 移除 user:@用户    # 移除自动反应
```

### 📊 数据管理命令
```
/发言总结 user:@用户 format:向量化 limit:100    # 收集用户发言
/发言总结 format:简洁 limit:0    # 收集全服发言（简洁格式）
```

### 🎮 用户互动命令
```
/签到              # 每日签到
/积分              # 查看积分状态
```

### 🛡️ 管理命令
```
/状态              # 查看bot状态
/查看ID            # 查看当前服务器和频道ID
/详细ID target:目标    # [主人] 查看详细的ID信息
/私聊授权 添加 user:@用户    # 授权私聊权限
/屏蔽词 添加 不当词汇    # 添加屏蔽词
/清除所有人上下文    # 清除所有对话历史
/日志 设置 guild_id:服务器ID channel_id:频道ID log_type:日志类型    # 设置日志频道
/日志 发送 log_type:日志类型 message:消息内容    # 发送测试日志
/日志 列表        # 查看所有日志设置
/日志 删除 guild_id:服务器ID log_type:日志类型    # 删除日志设置
/手动描述表情 emoji:<表情> description:描述  # 为指定表情添加或修改描述，用于优化搜索
```

### 🎭 伪装发言
现在，任何人都可以使用伪装功能，以机器人的身份自由发言。

| 命令 | 类型 | 描述 |
| --- | --- | --- |
| `/伪装发言` | 斜杠命令 | 以机器人的身份发送消息。支持 `:表情名:` 语法、`reply_to` 回复和 `target_user` @目标。 |
| `以此消息伪装回复` | 右键菜单 | **（主人专属）** 在任意消息上右键，选择“应用” > “以此消息伪装回复”，即可快速回复该消息。 |
| `/寻找表情` | 斜杠命令 | 通过关键词搜索机器人可用的所有表情，提供交互式列表。 |

**使用方法：**

**方式一：快速回复（主人专属）**
1.  在您想回复的消息上**右键点击**。
2.  在菜单中选择 **应用** > **以此消息伪装回复**。
3.  一个输入框会弹出，并已**自动填好**原消息的内容。
4.  您可以直接修改内容，比如在后面加上 `:thinking_cat:`。
5.  点击“提交”，机器人就会以回复的形式发送“你说的很有道理 🤔”，操作流畅，一步到位。

**方式二：使用斜杠命令（公开）**
- **发送新消息**: `/伪装发言 content:大家好 :sun:`
- **回复指定消息**: `/伪装发言 content:原来是这样 :aha: reply_to:123456789012345678`
- **@某人并发送消息**: `/伪装发言 content:你好啊！ target_user:@用户名`
- **组合使用**: `/伪装发言 content:你同意吗？ target_user:@用户名 reply_to:123456789012345678`

## 🔧 高级功能

### 🧠 AI人格系统
内置多种人格模式：
- **米尔可主人格**：温柔可爱的AI助手
- **沙雕搞怪型**：幽默风趣的互动风格
- **学术严谨型**：专业严谨的回复风格
- **古风诗意型**：古典优雅的表达方式
- **傲娇型**：傲娇可爱的性格设定
- **自定义**：支持自定义人格内容

> **更新：自定义AI人格支持持久化到Hugging Face数据库，所有上传/切换/删除的人格都会自动云端同步，无需本地文件，支持多实例一致性。**

### 🎨 风格系统
- **默认**：标准回复风格
- **侦探**：推理分析风格
- **猫娘**：可爱萌系风格
- **自定义**：支持自定义风格

### 📊 数据格式说明

#### 简洁格式
```json
{
  "u": "用户名",
  "n": 消息数量,
  "s": ["统计信息"],
  "m": [{"t": "文本", "ts": 时间戳}]
}
```

#### 详细格式
```json
{
  "u": "用户名",
  "g": "服务器名",
  "n": 消息数量,
  "s": ["统计信息"],
  "m": [{"c": "频道", "t": "文本", "ts": 时间戳, "a": "附件", "e": "嵌入"}]
}
```

#### 向量化格式
```json
{
  "u": "用户名",
  "n": 消息数量,
  "stats": {"total_chars": 总字符, "avg_length": 平均长度, "media_ratio": 媒体比例},
  "s": ["统计信息"],
  "m": [{"t": "截断文本", "l": 长度, "ts": 时间戳, "h": 是否有媒体}]
}
```

## 🛡️ 安全特性

- **权限控制**：所有管理功能需要主人权限
- **内容过滤**：自动屏蔽不当内容
- **私聊保护**：文爱模式仅在服务器中生效
- **数据安全**：敏感数据加密存储
- **错误处理**：完善的异常处理机制

## 🔄 部署选项

### Hugging Face Spaces (推荐)
1. Fork此仓库到你的Hugging Face账户
2. 在Settings中配置环境变量
3. 自动部署，无需服务器

### 本地部署
1. 按照快速开始步骤配置
2. 使用`python bot.py`启动
3. 或使用Docker部署

### Docker部署
```bash
docker build -t milyk-bot .
docker run -e BOT_TOKEN=your_token -e BOT_OWNER_ID=your_id milyk-bot
```

## 📝 更新日志

### v2.0.0 (最新)
- ✨ 新增文爱模式功能
- 🚀 优化自动反应系统
- 📊 改进数据收集功能
- 🛡️ 增强安全性和稳定性

### v1.5.0
- 🧠 添加AI人格系统
- 🎨 实现风格切换功能
- 📊 新增发言总结功能
- 🤖 完善自动反应系统

### v1.0.0
- 🎉 初始版本发布
- 🧠 基础AI对话功能
- 🎮 签到积分系统
- 🛡️ 基础管理功能

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目！

### 开发环境设置
1. Fork项目
2. 创建功能分支
3. 提交更改
4. 创建Pull Request

## 📄 许可证

本项目采用MIT许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙏 致谢

- [Discord.py](https://discordpy.readthedocs.io/) - Discord API包装器
- [Google Gemini](https://ai.google.dev/) - AI模型服务
- [Hugging Face](https://huggingface.co/) - 部署平台

---

**Milky** - 让Discord聊天更智能、更有趣！ 💕